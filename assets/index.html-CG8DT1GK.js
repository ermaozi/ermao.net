import{e as ge,h as ne,s as me,v as ze,f as _e,g as We,i as je,j as $,t as se,k as xe,n as Fe,_ as Ue,u as Ve,o as R,c as W,b as p,F as He,l as Xe,m as Ge,p as ae,q as fe,x as ve,y as j,z as F,A as U,B as V,C as w,a as Ze}from"./app-BAtzL_nP.js";import{C as oe,B as qe,D as Je,L as Ke,m as q,r as g,v as Ye,c as we,i as X,t as Qe,d as et,a as tt,A as ke,P as Ce,b as Me,e as at,f as rt,g as nt,h as st,j as it,p as ot,k as lt,l as ut,n as dt}from"./chart-bZqiLtLs.js";const Se={data:{type:Object,required:!0},options:{type:Object,default:()=>({})},plugins:{type:Array,default:()=>[]},datasetIdKey:{type:String,default:"label"},updateMode:{type:String,default:void 0}},ct={ariaLabel:{type:String},ariaDescribedby:{type:String}},ft={type:{type:String,required:!0},destroyDelay:{type:Number,default:0},...Se,...ct},vt=ze[0]==="2"?(e,a)=>Object.assign(e,{attrs:a}):(e,a)=>Object.assign(e,a);function z(e){return xe(e)?se(e):e}function ht(e){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e;return xe(a)?new Proxy(e,{}):e}function pt(e,a){const t=e.options;t&&a&&Object.assign(t,a)}function De(e,a){e.labels=a}function Pe(e,a,t){const r=[];e.datasets=a.map(n=>{const s=e.datasets.find(i=>i[t]===n[t]);return!s||!n.data||r.includes(s)?{...n}:(r.push(s),Object.assign(s,n),s)})}function yt(e,a){const t={labels:[],datasets:[]};return De(t,e.labels),Pe(t,e.datasets,a),t}const bt=ge({props:ft,setup(e,a){let{expose:t,slots:r}=a;const n=$(null),s=me(null);t({chart:s});const i=()=>{if(!n.value)return;const{type:u,data:f,options:h,plugins:_,datasetIdKey:L}=e,O=yt(f,L),k=ht(O,f);s.value=new oe(n.value,{type:u,data:k,options:{...h},plugins:_})},l=()=>{const u=se(s.value);u&&(e.destroyDelay>0?setTimeout(()=>{u.destroy(),s.value=null},e.destroyDelay):(u.destroy(),s.value=null))},d=u=>{u.update(e.updateMode)};return _e(i),We(l),je([()=>e.options,()=>e.data],(u,f)=>{let[h,_]=u,[L,O]=f;const k=se(s.value);if(!k)return;let A=!1;if(h){const x=z(h),C=z(L);x&&x!==C&&(pt(k,x),A=!0)}if(_){const x=z(_.labels),C=z(O.labels),T=z(_.datasets),N=z(O.datasets);x!==C&&(De(k.config.data,x),A=!0),T&&T!==N&&(Pe(k.config.data,T,e.datasetIdKey),A=!0)}A&&Fe(()=>{d(k)})},{deep:!0}),()=>ne("canvas",{role:"img","aria-label":e.ariaLabel,"aria-describedby":e.ariaDescribedby,ref:n},[ne("p",{},[r.default?r.default():""])])}});function le(e,a){return oe.register(a),ge({props:Se,setup(t,r){let{expose:n}=r;const s=me(null),i=l=>{s.value=l?.chart};return n({chart:s}),()=>ne(bt,vt({ref:i},{type:e,...t}))}})}const he=le("bar",qe),pe=le("doughnut",Je),gt=le("line",Ke);/*!
 * chartjs-plugin-datalabels v2.2.0
 * https://chartjs-plugin-datalabels.netlify.app
 * (c) 2017-2022 chartjs-plugin-datalabels contributors
 * Released under the MIT license
 */var ye=(function(){if(typeof window<"u"){if(window.devicePixelRatio)return window.devicePixelRatio;var e=window.screen;if(e)return(e.deviceXDPI||1)/(e.logicalXDPI||1)}return 1})(),G={toTextLines:function(e){var a=[],t;for(e=[].concat(e);e.length;)t=e.pop(),typeof t=="string"?a.unshift.apply(a,t.split(`
`)):Array.isArray(t)?e.push.apply(e,t):X(e)||a.unshift(""+t);return a},textSize:function(e,a,t){var r=[].concat(a),n=r.length,s=e.font,i=0,l;for(e.font=t.string,l=0;l<n;++l)i=Math.max(e.measureText(r[l]).width,i);return e.font=s,{height:n*t.lineHeight,width:i}},bound:function(e,a,t){return Math.max(e,Math.min(a,t))},arrayDiff:function(e,a){var t=e.slice(),r=[],n,s,i,l;for(n=0,i=a.length;n<i;++n)l=a[n],s=t.indexOf(l),s===-1?r.push([l,1]):t.splice(s,1);for(n=0,i=t.length;n<i;++n)r.push([t[n],-1]);return r},rasterize:function(e){return Math.round(e*ye)/ye}};function re(e,a){var t=a.x,r=a.y;if(t===null)return{x:0,y:-1};if(r===null)return{x:1,y:0};var n=e.x-t,s=e.y-r,i=Math.sqrt(n*n+s*s);return{x:i?n/i:0,y:i?s/i:-1}}function mt(e,a,t,r,n){switch(n){case"center":t=r=0;break;case"bottom":t=0,r=1;break;case"right":t=1,r=0;break;case"left":t=-1,r=0;break;case"top":t=0,r=-1;break;case"start":t=-t,r=-r;break;case"end":break;default:n*=Math.PI/180,t=Math.cos(n),r=Math.sin(n);break}return{x:e,y:a,vx:t,vy:r}}var _t=0,Te=1,Re=2,Ae=4,Ie=8;function J(e,a,t){var r=_t;return e<t.left?r|=Te:e>t.right&&(r|=Re),a<t.top?r|=Ie:a>t.bottom&&(r|=Ae),r}function xt(e,a){for(var t=e.x0,r=e.y0,n=e.x1,s=e.y1,i=J(t,r,a),l=J(n,s,a),d,u,f;!(!(i|l)||i&l);)d=i||l,d&Ie?(u=t+(n-t)*(a.top-r)/(s-r),f=a.top):d&Ae?(u=t+(n-t)*(a.bottom-r)/(s-r),f=a.bottom):d&Re?(f=r+(s-r)*(a.right-t)/(n-t),u=a.right):d&Te&&(f=r+(s-r)*(a.left-t)/(n-t),u=a.left),d===i?(t=u,r=f,i=J(t,r,a)):(n=u,s=f,l=J(n,s,a));return{x0:t,x1:n,y0:r,y1:s}}function K(e,a){var t=a.anchor,r=e,n,s;return a.clamp&&(r=xt(r,a.area)),t==="start"?(n=r.x0,s=r.y0):t==="end"?(n=r.x1,s=r.y1):(n=(r.x0+r.x1)/2,s=(r.y0+r.y1)/2),mt(n,s,e.vx,e.vy,a.align)}var Y={arc:function(e,a){var t=(e.startAngle+e.endAngle)/2,r=Math.cos(t),n=Math.sin(t),s=e.innerRadius,i=e.outerRadius;return K({x0:e.x+r*s,y0:e.y+n*s,x1:e.x+r*i,y1:e.y+n*i,vx:r,vy:n},a)},point:function(e,a){var t=re(e,a.origin),r=t.x*e.options.radius,n=t.y*e.options.radius;return K({x0:e.x-r,y0:e.y-n,x1:e.x+r,y1:e.y+n,vx:t.x,vy:t.y},a)},bar:function(e,a){var t=re(e,a.origin),r=e.x,n=e.y,s=0,i=0;return e.horizontal?(r=Math.min(e.x,e.base),s=Math.abs(e.base-e.x)):(n=Math.min(e.y,e.base),i=Math.abs(e.base-e.y)),K({x0:r,y0:n+i,x1:r+s,y1:n,vx:t.x,vy:t.y},a)},fallback:function(e,a){var t=re(e,a.origin);return K({x0:e.x,y0:e.y,x1:e.x+(e.width||0),y1:e.y+(e.height||0),vx:t.x,vy:t.y},a)}},E=G.rasterize;function wt(e){var a=e.borderWidth||0,t=e.padding,r=e.size.height,n=e.size.width,s=-n/2,i=-r/2;return{frame:{x:s-t.left-a,y:i-t.top-a,w:n+t.width+a*2,h:r+t.height+a*2},text:{x:s,y:i,w:n,h:r}}}function kt(e,a){var t=a.chart.getDatasetMeta(a.datasetIndex).vScale;if(!t)return null;if(t.xCenter!==void 0&&t.yCenter!==void 0)return{x:t.xCenter,y:t.yCenter};var r=t.getBasePixel();return e.horizontal?{x:r,y:null}:{x:null,y:r}}function Ct(e){return e instanceof ke?Y.arc:e instanceof Ce?Y.point:e instanceof Me?Y.bar:Y.fallback}function Mt(e,a,t,r,n,s){var i=Math.PI/2;if(s){var l=Math.min(s,n/2,r/2),d=a+l,u=t+l,f=a+r-l,h=t+n-l;e.moveTo(a,u),d<f&&u<h?(e.arc(d,u,l,-Math.PI,-i),e.arc(f,u,l,-i,0),e.arc(f,h,l,0,i),e.arc(d,h,l,i,Math.PI)):d<f?(e.moveTo(d,t),e.arc(f,u,l,-i,i),e.arc(d,u,l,i,Math.PI+i)):u<h?(e.arc(d,u,l,-Math.PI,0),e.arc(d,h,l,0,Math.PI)):e.arc(d,u,l,-Math.PI,Math.PI),e.closePath(),e.moveTo(a,t)}else e.rect(a,t,r,n)}function St(e,a,t){var r=t.backgroundColor,n=t.borderColor,s=t.borderWidth;!r&&(!n||!s)||(e.beginPath(),Mt(e,E(a.x)+s/2,E(a.y)+s/2,E(a.w)-s,E(a.h)-s,t.borderRadius),e.closePath(),r&&(e.fillStyle=r,e.fill()),n&&s&&(e.strokeStyle=n,e.lineWidth=s,e.lineJoin="miter",e.stroke()))}function Dt(e,a,t){var r=t.lineHeight,n=e.w,s=e.x,i=e.y+r/2;return a==="center"?s+=n/2:(a==="end"||a==="right")&&(s+=n),{h:r,w:n,x:s,y:i}}function Pt(e,a,t){var r=e.shadowBlur,n=t.stroked,s=E(t.x),i=E(t.y),l=E(t.w);n&&e.strokeText(a,s,i,l),t.filled&&(r&&n&&(e.shadowBlur=0),e.fillText(a,s,i,l),r&&n&&(e.shadowBlur=r))}function Tt(e,a,t,r){var n=r.textAlign,s=r.color,i=!!s,l=r.font,d=a.length,u=r.textStrokeColor,f=r.textStrokeWidth,h=u&&f,_;if(!(!d||!i&&!h))for(t=Dt(t,n,l),e.font=l.string,e.textAlign=n,e.textBaseline="middle",e.shadowBlur=r.textShadowBlur,e.shadowColor=r.textShadowColor,i&&(e.fillStyle=s),h&&(e.lineJoin="round",e.lineWidth=f,e.strokeStyle=u),_=0,d=a.length;_<d;++_)Pt(e,a[_],{stroked:h,filled:i,w:t.w,x:t.x,y:t.y+t.h*_})}var Oe=function(e,a,t,r){var n=this;n._config=e,n._index=r,n._model=null,n._rects=null,n._ctx=a,n._el=t};q(Oe.prototype,{_modelize:function(e,a,t,r){var n=this,s=n._index,i=Qe(g([t.font,{}],r,s)),l=g([t.color,et.color],r,s);return{align:g([t.align,"center"],r,s),anchor:g([t.anchor,"center"],r,s),area:r.chart.chartArea,backgroundColor:g([t.backgroundColor,null],r,s),borderColor:g([t.borderColor,null],r,s),borderRadius:g([t.borderRadius,0],r,s),borderWidth:g([t.borderWidth,0],r,s),clamp:g([t.clamp,!1],r,s),clip:g([t.clip,!1],r,s),color:l,display:e,font:i,lines:a,offset:g([t.offset,4],r,s),opacity:g([t.opacity,1],r,s),origin:kt(n._el,r),padding:tt(g([t.padding,4],r,s)),positioner:Ct(n._el),rotation:g([t.rotation,0],r,s)*(Math.PI/180),size:G.textSize(n._ctx,a,i),textAlign:g([t.textAlign,"start"],r,s),textShadowBlur:g([t.textShadowBlur,0],r,s),textShadowColor:g([t.textShadowColor,l],r,s),textStrokeColor:g([t.textStrokeColor,l],r,s),textStrokeWidth:g([t.textStrokeWidth,0],r,s)}},update:function(e){var a=this,t=null,r=null,n=a._index,s=a._config,i,l,d,u=g([s.display,!0],e,n);u&&(i=e.dataset.data[n],l=Ye(we(s.formatter,[i,e]),i),d=X(l)?[]:G.toTextLines(l),d.length&&(t=a._modelize(u,d,s,e),r=wt(t))),a._model=t,a._rects=r},geometry:function(){return this._rects?this._rects.frame:{}},rotation:function(){return this._model?this._model.rotation:0},visible:function(){return this._model&&this._model.opacity},model:function(){return this._model},draw:function(e,a){var t=this,r=e.ctx,n=t._model,s=t._rects,i;this.visible()&&(r.save(),n.clip&&(i=n.area,r.beginPath(),r.rect(i.left,i.top,i.right-i.left,i.bottom-i.top),r.clip()),r.globalAlpha=G.bound(0,n.opacity,1),r.translate(E(a.x),E(a.y)),r.rotate(n.rotation),St(r,s.frame,n),Tt(r,n.lines,s.text,n),r.restore())}});var Rt=Number.MIN_SAFE_INTEGER||-9007199254740991,At=Number.MAX_SAFE_INTEGER||9007199254740991;function H(e,a,t){var r=Math.cos(t),n=Math.sin(t),s=a.x,i=a.y;return{x:s+r*(e.x-s)-n*(e.y-i),y:i+n*(e.x-s)+r*(e.y-i)}}function be(e,a){var t=At,r=Rt,n=a.origin,s,i,l,d,u;for(s=0;s<e.length;++s)i=e[s],l=i.x-n.x,d=i.y-n.y,u=a.vx*l+a.vy*d,t=Math.min(t,u),r=Math.max(r,u);return{min:t,max:r}}function Q(e,a){var t=a.x-e.x,r=a.y-e.y,n=Math.sqrt(t*t+r*r);return{vx:(a.x-e.x)/n,vy:(a.y-e.y)/n,origin:e,ln:n}}var $e=function(){this._rotation=0,this._rect={x:0,y:0,w:0,h:0}};q($e.prototype,{center:function(){var e=this._rect;return{x:e.x+e.w/2,y:e.y+e.h/2}},update:function(e,a,t){this._rotation=t,this._rect={x:a.x+e.x,y:a.y+e.y,w:a.w,h:a.h}},contains:function(e){var a=this,t=1,r=a._rect;return e=H(e,a.center(),-a._rotation),!(e.x<r.x-t||e.y<r.y-t||e.x>r.x+r.w+t*2||e.y>r.y+r.h+t*2)},intersects:function(e){var a=this._points(),t=e._points(),r=[Q(a[0],a[1]),Q(a[0],a[3])],n,s,i;for(this._rotation!==e._rotation&&r.push(Q(t[0],t[1]),Q(t[0],t[3])),n=0;n<r.length;++n)if(s=be(a,r[n]),i=be(t,r[n]),s.max<i.min||i.max<s.min)return!1;return!0},_points:function(){var e=this,a=e._rect,t=e._rotation,r=e.center();return[H({x:a.x,y:a.y},r,t),H({x:a.x+a.w,y:a.y},r,t),H({x:a.x+a.w,y:a.y+a.h},r,t),H({x:a.x,y:a.y+a.h},r,t)]}});function Ee(e,a,t){var r=a.positioner(e,a),n=r.vx,s=r.vy;if(!n&&!s)return{x:r.x,y:r.y};var i=t.w,l=t.h,d=a.rotation,u=Math.abs(i/2*Math.cos(d))+Math.abs(l/2*Math.sin(d)),f=Math.abs(i/2*Math.sin(d))+Math.abs(l/2*Math.cos(d)),h=1/Math.max(Math.abs(n),Math.abs(s));return u*=n*h,f*=s*h,u+=a.offset*n,f+=a.offset*s,{x:r.x+u,y:r.y+f}}function It(e,a){var t,r,n,s;for(t=e.length-1;t>=0;--t)for(n=e[t].$layout,r=t-1;r>=0&&n._visible;--r)s=e[r].$layout,s._visible&&n._box.intersects(s._box)&&a(n,s);return e}function Ot(e){var a,t,r,n,s,i,l;for(a=0,t=e.length;a<t;++a)r=e[a],n=r.$layout,n._visible&&(l=new Proxy(r._el,{get:(d,u)=>d.getProps([u],!0)[u]}),s=r.geometry(),i=Ee(l,r.model(),s),n._box.update(i,s,r.rotation()));return It(e,function(d,u){var f=d._hidable,h=u._hidable;f&&h||h?u._visible=!1:f&&(d._visible=!1)})}var Z={prepare:function(e){var a=[],t,r,n,s,i;for(t=0,n=e.length;t<n;++t)for(r=0,s=e[t].length;r<s;++r)i=e[t][r],a.push(i),i.$layout={_box:new $e,_hidable:!1,_visible:!0,_set:t,_idx:i._index};return a.sort(function(l,d){var u=l.$layout,f=d.$layout;return u._idx===f._idx?f._set-u._set:f._idx-u._idx}),this.update(a),a},update:function(e){var a=!1,t,r,n,s,i;for(t=0,r=e.length;t<r;++t)n=e[t],s=n.model(),i=n.$layout,i._hidable=s&&s.display==="auto",i._visible=n.visible(),a|=i._hidable;a&&Ot(e)},lookup:function(e,a){var t,r;for(t=e.length-1;t>=0;--t)if(r=e[t].$layout,r&&r._visible&&r._box.contains(a))return e[t];return null},draw:function(e,a){var t,r,n,s,i,l;for(t=0,r=a.length;t<r;++t)n=a[t],s=n.$layout,s._visible&&(i=n.geometry(),l=Ee(n._el,n.model(),i),s._box.update(l,i,n.rotation()),n.draw(e,l))}},$t=function(e){if(X(e))return null;var a=e,t,r,n;if(at(e))if(!X(e.label))a=e.label;else if(!X(e.r))a=e.r;else for(a="",t=Object.keys(e),n=0,r=t.length;n<r;++n)a+=(n!==0?", ":"")+t[n]+": "+e[t[n]];return""+a},Et={align:"center",anchor:"center",backgroundColor:null,borderColor:null,borderRadius:0,borderWidth:0,clamp:!1,clip:!1,color:void 0,display:!0,font:{family:void 0,lineHeight:1.2,size:void 0,style:void 0,weight:null},formatter:$t,labels:void 0,listeners:{},offset:4,opacity:1,padding:{top:4,right:4,bottom:4,left:4},rotation:0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,textShadowBlur:0,textShadowColor:void 0},S="$datalabels",Le="$default";function Lt(e,a){var t=e.datalabels,r={},n=[],s,i;return t===!1?null:(t===!0&&(t={}),a=q({},[a,t]),s=a.labels||{},i=Object.keys(s),delete a.labels,i.length?i.forEach(function(l){s[l]&&n.push(q({},[a,s[l],{_key:l}]))}):n.push(a),r=n.reduce(function(l,d){return rt(d.listeners||{},function(u,f){l[f]=l[f]||{},l[f][d._key||Le]=u}),delete d.listeners,l},{}),{labels:n,listeners:r})}function ie(e,a,t,r){if(a){var n=t.$context,s=t.$groups,i;a[s._set]&&(i=a[s._set][s._key],i&&we(i,[n,r])===!0&&(e[S]._dirty=!0,t.update(n)))}}function Nt(e,a,t,r,n){var s,i;!t&&!r||(t?r?t!==r&&(i=s=!0):i=!0:s=!0,i&&ie(e,a.leave,t,n),s&&ie(e,a.enter,r,n))}function Bt(e,a){var t=e[S],r=t._listeners,n,s;if(!(!r.enter&&!r.leave)){if(a.type==="mousemove")s=Z.lookup(t._labels,a);else if(a.type!=="mouseout")return;n=t._hovered,t._hovered=s,Nt(e,r,n,s,a)}}function zt(e,a){var t=e[S],r=t._listeners.click,n=r&&Z.lookup(t._labels,a);n&&ie(e,r,n,a)}var Wt={id:"datalabels",defaults:Et,beforeInit:function(e){e[S]={_actives:[]}},beforeUpdate:function(e){var a=e[S];a._listened=!1,a._listeners={},a._datasets=[],a._labels=[]},afterDatasetUpdate:function(e,a,t){var r=a.index,n=e[S],s=n._datasets[r]=[],i=e.isDatasetVisible(r),l=e.data.datasets[r],d=Lt(l,t),u=a.meta.data||[],f=e.ctx,h,_,L,O,k,A,x,C;for(f.save(),h=0,L=u.length;h<L;++h)if(x=u[h],x[S]=[],i&&x&&e.getDataVisibility(h)&&!x.skip)for(_=0,O=d.labels.length;_<O;++_)k=d.labels[_],A=k._key,C=new Oe(k,f,x,h),C.$groups={_set:r,_key:A||Le},C.$context={active:!1,chart:e,dataIndex:h,dataset:l,datasetIndex:r},C.update(C.$context),x[S].push(C),s.push(C);f.restore(),q(n._listeners,d.listeners,{merger:function(T,N,ee){N[T]=N[T]||{},N[T][a.index]=ee[T],n._listened=!0}})},afterUpdate:function(e){e[S]._labels=Z.prepare(e[S]._datasets)},afterDatasetsDraw:function(e){Z.draw(e,e[S]._labels)},beforeEvent:function(e,a){if(e[S]._listened){var t=a.event;switch(t.type){case"mousemove":case"mouseout":Bt(e,t);break;case"click":zt(e,t);break}}},afterEvent:function(e){var a=e[S],t=a._actives,r=a._actives=e.getActiveElements(),n=G.arrayDiff(t,r),s,i,l,d,u,f,h;for(s=0,i=n.length;s<i;++s)if(u=n[s],u[1])for(h=u[0].element[S]||[],l=0,d=h.length;l<d;++l)f=h[l],f.$context.active=u[1]===1,f.update(f.$context);(a._dirty||n.length)&&(Z.update(a._labels),e.render()),delete a._dirty}};const jt={class:"stats-container"},Ft={class:"controls"},Ut={class:"btn-group"},Vt=["onClick"],Ht={class:"date-picker-group"},Xt=["disabled"],Gt={key:0,class:"loading"},Zt={key:1,class:"error"},qt={key:2,class:"stats-content"},Jt={class:"summary-card"},Kt={class:"big-number"},Yt={class:"card chart-card"},Qt={class:"chart-container line-chart-height"},ea={class:"grid"},ta={class:"card"},aa={class:"chart-container bar-chart-height"},ra={class:"card"},na={class:"chart-container bar-chart-height"},sa={class:"grid"},ia={class:"card"},oa={class:"chart-container pie-container"},la={class:"card"},ua={class:"chart-container pie-container"},da={__name:"StatsPage",setup(e){oe.register(nt,st,Ce,it,Me,ke,ot,lt,ut,dt,Wt);let a='"https://views.ermao.net"';typeof a=="string"&&a.startsWith('"')&&a.endsWith('"')&&(a=a.slice(1,-1));const t=$({total:0,pages:[],countries:[],uas:[],timeSeries:[],refs:[]}),r=$(!1),n=$(null),s=$("24h"),i=$(""),l=$(""),d=$(!1),u=Ve(),f=$(new Map),h=[{label:"24 小时",value:"24h"},{label:"7 天",value:"7d"},{label:"30 天",value:"30d"},{label:"1 年",value:"1y"}],_=v=>{if(!v)return"Unknown";if(w&&w[v])return w[v];let o=v;try{o=decodeURI(v)}catch{}if(w&&w[o])return w[o];const c=o.replace(/(\.html|\/)$/,"");return w&&w[c]?w[c]:w&&w[c+".html"]?w[c+".html"]:w&&w[c+"/"]?w[c+"/"]:f.value.has(v)?f.value.get(v):o||v},L=v=>{if(!v||v==="Unknown"||v==="XX")return"未知地区";try{return new Intl.DisplayNames(["zh-Hans"],{type:"region"}).of(v)||v}catch{return v}},O=()=>{const v=u.getRoutes();for(const o of v)o.meta&&o.meta.title&&f.value.set(o.path,o.meta.title)},k=V(()=>{const v=t.value.timeSeries||[],o=[],c=new Date;if(d.value&&t.value.range){const y=t.value.range.start,M=t.value.range.end,D=M-y,P=24*3600*1e3;let I,B,te;if(D<=P+1e3?(I=3600*1e3,B=b=>b.toISOString().slice(0,13).replace("T"," ")+":00",te=b=>b.getHours()+":00"):D>180*P?I=30*P:(I=P,B=b=>b.toISOString().slice(0,10),te=b=>b.getMonth()+1+"-"+b.getDate()),B)for(let b=y;b<=M;b+=I){const ce=new Date(b);o.push({label:B(ce),displayLabel:te(ce),value:0})}else return v.forEach(b=>{o.push({label:b.label,displayLabel:b.label,value:b.count})}),{labels:o.map(b=>b.displayLabel),datasets:[{label:"Visits",backgroundColor:"rgba(62, 175, 124, 0.2)",borderColor:"#3eaf7c",pointBackgroundColor:"#3eaf7c",data:o.map(b=>b.value),fill:!0,tension:.4}]}}else{const y=s.value;if(y==="24h")for(let M=23;M>=0;M--){const D=new Date(c.getTime()-M*3600*1e3),P=D.toISOString().slice(0,13).replace("T"," ")+":00",I=D.getHours()+":00";o.push({label:P,displayLabel:I,value:0})}else if(y==="7d"||y==="30d"){const M=y==="7d"?7:30;for(let D=M-1;D>=0;D--){const P=new Date(c.getTime()-D*24*3600*1e3),I=P.toISOString().slice(0,10),B=P.getMonth()+1+"-"+P.getDate();o.push({label:I,displayLabel:B,value:0})}}else if(y==="1y")for(let M=11;M>=0;M--){const D=new Date(c.getFullYear(),c.getMonth()-M,1),P=D.toISOString().slice(0,7),I=D.getFullYear()+"-"+(D.getMonth()+1);o.push({label:P,displayLabel:I,value:0})}}const m=new Map(v.map(y=>[y.label,y.count]));return o.forEach(y=>{m.has(y.label)&&(y.value=m.get(y.label))}),{labels:o.map(y=>y.displayLabel),datasets:[{label:"Visits",backgroundColor:"rgba(62, 175, 124, 0.2)",borderColor:"#3eaf7c",pointBackgroundColor:"#3eaf7c",data:o.map(y=>y.value),fill:!0,tension:.4}]}}),A=V(()=>{const v=(t.value.pages||[]).slice(0,15);return{labels:v.map(o=>{const c=_(o.path);return c.length>20?c.substring(0,15)+"...":c}),datasets:[{label:"Views",backgroundColor:"#3eaf7c",data:v.map(o=>o.count),barPercentage:.6}]}}),x=V(()=>{const v=(t.value.countries||[]).slice(0,10),o=["#3eaf7c","#3498db","#f1c40f","#e74c3c","#9b59b6","#1abc9c","#e67e22","#34495e","#2ecc71","#95a5a6"];return{labels:v.map(c=>L(c.country)),datasets:[{backgroundColor:o,data:v.map(c=>c.count),hoverOffset:8,borderRadius:5,borderWidth:1}]}}),C=V(()=>{const v=t.value.uas||[],o=["#e74c3c","#8e44ad","#3498db","#16a085","#f39c12","#d35400","#2c3e50","#7f8c8d"];return{labels:v.map(c=>c.ua_group),datasets:[{backgroundColor:o,data:v.map(c=>c.count),hoverOffset:8,borderRadius:5,borderWidth:1}]}}),T=V(()=>{const v=(t.value.refs||[]).slice(0,15);return{labels:v.map(o=>o.ref.length>30?o.ref.substring(0,27)+"...":o.ref),datasets:[{label:"Visits",backgroundColor:"#3498db",data:v.map(o=>o.count),barPercentage:.6}]}}),N={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},datalabels:{display:!1}},scales:{y:{beginAtZero:!0,grid:{color:"#f0f0f0"}},x:{grid:{display:!1}}}},ee={indexAxis:"y",responsive:!0,maintainAspectRatio:!1,onClick:(v,o)=>{if(o&&o.length>0){const c=o[0].index,m=(t.value.pages||[]).slice(0,15);m[c]&&m[c].path&&window.open(m[c].path,"_blank")}},plugins:{legend:{display:!1},datalabels:{anchor:"end",align:"end",color:"#888",font:{weight:"bold"}}},scales:{x:{beginAtZero:!0},y:{grid:{display:!1}}}},Ne={indexAxis:"y",responsive:!0,maintainAspectRatio:!1,onClick:(v,o)=>{if(o&&o.length>0){const c=o[0].index,m=(t.value.refs||[]).slice(0,15);m[c]&&m[c].ref&&m[c].ref.startsWith("http")&&window.open(m[c].ref,"_blank")}},plugins:{legend:{display:!1},datalabels:{anchor:"end",align:"end",color:"#888",font:{weight:"bold"}}},scales:{x:{beginAtZero:!0},y:{grid:{display:!1}}}},ue={responsive:!0,maintainAspectRatio:!1,cutout:"60%",plugins:{legend:{position:"right",labels:{boxWidth:12,font:{size:12}}},datalabels:{color:"#fff",textAlign:"center",font:{weight:"bold"},formatter:(v,o)=>{let c=0;if(o.chart.data.datasets[0].data.map(M=>{c+=M}),c===0)return"";let y=(v*100/c).toFixed(1)+"%";return v<5?"":`${y}
${v}`}}}},Be=async()=>{if(!i.value||!l.value)return;const v=new Date(i.value+"T00:00:00").getTime(),o=new Date(l.value+"T23:59:59").getTime();if(!(isNaN(v)||isNaN(o))){s.value="",d.value=!0,r.value=!0,n.value=null;try{const c=await fetch(`${a}/stats?start=${v}&end=${o}`),m=c.headers.get("content-type");if(!m||!m.includes("application/json"))throw new Error("Worker returned non-JSON response.");if(!c.ok)throw new Error(`Failed to fetch stats: ${c.status}`);const y=await c.json();t.value=y}catch(c){n.value=c.message}finally{r.value=!1}}},de=async v=>{if(!a){n.value="Worker URL not configured";return}r.value=!0,s.value=v,d.value=!1,i.value="",l.value="",n.value=null;try{const o=await fetch(`${a}/stats?period=${v}`),c=o.headers.get("content-type");if(!c||!c.includes("application/json")){const y=await o.text();throw new Error(`Worker returned non-JSON response. Status: ${o.status}`)}if(!o.ok)throw new Error(`Failed to fetch stats: ${o.status} ${o.statusText}`);const m=await o.json();t.value=m}catch(o){n.value=o.message}finally{r.value=!1}};return _e(()=>{O(),de("24h")}),(v,o)=>(R(),W("div",jt,[o[10]||(o[10]=p("h1",null,"网站数据",-1)),o[11]||(o[11]=p("br",null,null,-1)),o[12]||(o[12]=p("br",null,null,-1)),p("div",Ft,[p("div",Ut,[(R(),W(He,null,Xe(h,c=>p("button",{key:c.value,class:Ge({active:s.value===c.value}),onClick:m=>de(c.value)},ae(c.label),11,Vt)),64))]),p("div",Ht,[fe(p("input",{type:"date","onUpdate:modelValue":o[0]||(o[0]=c=>i.value=c)},null,512),[[ve,i.value]]),o[2]||(o[2]=p("span",null,"至",-1)),fe(p("input",{type:"date","onUpdate:modelValue":o[1]||(o[1]=c=>l.value=c)},null,512),[[ve,l.value]]),p("button",{onClick:Be,disabled:!i.value||!l.value},"查询",8,Xt)])]),r.value?(R(),W("div",Gt,"Loading stats...")):n.value?(R(),W("div",Zt,ae(n.value),1)):(R(),W("div",qt,[p("div",Jt,[p("div",Kt,ae(t.value.total),1)]),p("div",Yt,[o[3]||(o[3]=p("h3",null,"Visits Over Time",-1)),p("div",Qt,[k.value?(R(),j(F(gt),{key:0,data:k.value,options:N},null,8,["data"])):U("",!0)])]),o[8]||(o[8]=p("br",null,null,-1)),p("div",ea,[p("div",ta,[o[4]||(o[4]=p("h3",null,"页面访问",-1)),p("div",aa,[A.value?(R(),j(F(he),{key:0,data:A.value,options:ee},null,8,["data"])):U("",!0)])]),p("div",ra,[o[5]||(o[5]=p("h3",null,"访客来源",-1)),p("div",na,[T.value?(R(),j(F(he),{key:0,data:T.value,options:Ne},null,8,["data"])):U("",!0)])])]),o[9]||(o[9]=p("br",null,null,-1)),p("div",sa,[p("div",ia,[o[6]||(o[6]=p("h3",null,"国家 / 地区",-1)),p("div",oa,[x.value?(R(),j(F(pe),{key:0,data:x.value,options:ue},null,8,["data"])):U("",!0)])]),p("div",la,[o[7]||(o[7]=p("h3",null,"终端",-1)),p("div",ua,[C.value?(R(),j(F(pe),{key:0,data:C.value,options:ue},null,8,["data"])):U("",!0)])])])]))]))}},ca=Ue(da,[["__scopeId","data-v-6b116c96"]]),ha={__name:"index.html",setup(e){return(a,t)=>(R(),W("div",null,[Ze(ca)]))}},pa=JSON.parse('{"path":"/stats/","title":"","lang":"zh-CN","frontmatter":{"pageClass":"custom-page-class","layout":"Layout","sidebar":false,"aside":false,"comments":false,"stats":false,"permalink":"/stats/","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2026-01-14T10:39:04.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://www.ermao.net/stats/"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2026-01-14T10:39:04.000Z"}],["meta",{"property":"article:modified_time","content":"2026-01-14T10:39:04.000Z"}]]},"readingTime":{"minutes":0.4,"words":120},"git":{"createdTime":1768387144000,"updatedTime":1768387144000,"contributors":[{"name":"ermaozi","username":"ermaozi","email":"admin@ermao.net","commits":1,"avatar":"https://avatars.githubusercontent.com/ermaozi?v=4","url":"https://github.com/ermaozi"}]},"filePathRelative":"stats.md","headers":[]}');export{ha as comp,pa as data};
